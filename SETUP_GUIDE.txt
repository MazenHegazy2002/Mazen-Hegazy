ZYLOS NEURAL LINK - DATABASE SETUP GUIDE
========================================

To make your WhatsApp/Telegram hybrid app fully functional, you need to set up your Supabase project with the following tables.

STEP 1: OPEN SQL EDITOR
-----------------------
Log in to your Supabase Dashboard, select your project, and click on "SQL Editor" in the left sidebar.

STEP 2: RUN THE SCHEMA
----------------------
Copy and paste the following block into a "New Query" and click "Run":

-- 1. Create the Profiles Table (Stores User Identities)
CREATE TABLE IF NOT EXISTS public.profiles (
  id UUID PRIMARY KEY,
  phone TEXT UNIQUE NOT NULL,
  name TEXT,
  avatar TEXT,
  status TEXT DEFAULT 'online',
  last_seen TIMESTAMPTZ DEFAULT NOW()
);

-- 2. Create the Messages Table (The Real-time Relay)
CREATE TABLE IF NOT EXISTS public.messages (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  chat_id TEXT NOT NULL,
  sender_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  recipient_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  type TEXT NOT NULL DEFAULT 'TEXT',
  timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- 3. Create the Statuses Table (The Story Feed)
CREATE TABLE IF NOT EXISTS public.statuses (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  image_url TEXT NOT NULL,
  caption TEXT,
  timestamp TIMESTAMPTZ DEFAULT NOW()
);

-- 4. Enable Row Level Security (Simple mode for demo)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.statuses ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow all" ON public.profiles FOR ALL USING (true) WITH CHECK (true);
CREATE POLICY "Allow all" ON public.messages FOR ALL USING (true) WITH CHECK (true);
CREATE POLICY "Allow all" ON public.statuses FOR ALL USING (true) WITH CHECK (true);

-- 5. Activate Real-time
-- This is critical for chats and status updates to appear instantly!
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
ALTER PUBLICATION supabase_realtime ADD TABLE statuses;

STEP 3: VERIFICATION
--------------------
Once the query runs successfully, you can go to the "Table Editor" to see your three new tables. You can now sign in to Zylos using any phone number.

Note: Zylos uses end-to-end encryption. Even though messages are stored in your database, they will appear as "zylos_v1_..." (encrypted ciphertext) to anyone looking at the raw table data. Only the users in the chat can read them!
